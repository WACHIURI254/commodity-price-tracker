<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Kenya Commodity Price Tracker</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.0/chart.umd.min.js"></script>
<style>
/* ======= Styles ======= */
*{margin:0;padding:0;box-sizing:border-box;}
:root{--primary:#2C5F2D;--secondary:#97BC62;--accent:#4A7C59;--danger:#DC3545;--warning:#FFC107;--success:#28A745;--dark:#2C3E50;--light:#F8F9FA;--border:#DEE2E6;}
body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,'Helvetica Neue',Arial,sans-serif;background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);min-height:100vh;color:#333;}
.container{max-width:1400px;margin:0 auto;padding:20px;}
header{background:rgba(255,255,255,0.98);border-radius:20px;padding:30px;margin-bottom:30px;box-shadow:0 10px 40px rgba(0,0,0,0.1);backdrop-filter:blur(10px);}
h1{color:var(--primary);font-size:2.5rem;margin-bottom:10px;display:flex;align-items:center;gap:15px;}
.flag{width:50px;height:35px;background:linear-gradient(to bottom, black 33%, red 33% 66%, green 66%);border-radius:3px;position:relative;overflow:hidden;}
.flag::before,.flag::after{content:'';position:absolute;background:white;height:100%;}
.flag::before{width:15%;left:42.5%;}
.flag::after{width:40%;left:30%;height:15%;top:42.5%;}
.subtitle{color:#666;font-size:1.1rem;margin-bottom:20px;}
.stats-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:15px;margin-top:20px;}
.stat-card{background:linear-gradient(135deg,var(--primary),var(--accent));color:white;padding:20px;border-radius:15px;text-align:center;transition:transform 0.3s;}
.stat-card:hover{transform:translateY(-5px);}
.stat-value{font-size:2rem;font-weight:bold;margin-bottom:5px;}
.stat-label{font-size:0.9rem;opacity:0.9;}
.search-section{background:white;border-radius:15px;padding:25px;margin-bottom:30px;box-shadow:0 5px 20px rgba(0,0,0,0.1);}
.search-controls{display:flex;gap:15px;flex-wrap:wrap;align-items:center;}
input,select{padding:12px 20px;border:2px solid var(--border);border-radius:10px;font-size:1rem;transition:border-color 0.3s;background:white;}
input:focus,select:focus{outline:none;border-color:var(--primary);}
.search-input{flex:1;min-width:250px;}
.filter-select{min-width:150px;}
button{padding:12px 25px;background:var(--primary);color:white;border:none;border-radius:10px;font-size:1rem;cursor:pointer;transition:all 0.3s;font-weight:600;}
button:hover{background:var(--accent);transform:translateY(-2px);box-shadow:0 5px 15px rgba(0,0,0,0.2);}
.tabs{display:flex;gap:10px;margin-bottom:30px;background:white;padding:10px;border-radius:15px;box-shadow:0 3px 10px rgba(0,0,0,0.1);}
.tab{padding:12px 25px;background:transparent;color:var(--dark);border:2px solid transparent;border-radius:10px;cursor:pointer;transition:all 0.3s;font-weight:500;}
.tab.active{background:var(--primary);color:white;border-color:var(--primary);}
.tab:hover:not(.active){background:var(--light);}
.content-area{background:white;border-radius:15px;padding:30px;box-shadow:0 5px 20px rgba(0,0,0,0.1);min-height:500px;}
.commodity-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(300px,1fr));gap:20px;margin-top:20px;}
.commodity-card{background:white;border:2px solid var(--border);border-radius:15px;padding:20px;transition:all 0.3s;position:relative;overflow:hidden;}
.commodity-card::before{content:'';position:absolute;top:0;left:0;width:100%;height:5px;background:linear-gradient(90deg,var(--primary),var(--secondary));}
.commodity-card:hover{transform:translateY(-5px);box-shadow:0 10px 30px rgba(0,0,0,0.15);border-color:var(--primary);}
.commodity-header{display:flex;justify-content:space-between;align-items:start;margin-bottom:15px;}
.commodity-name{font-size:1.2rem;font-weight:600;color:var(--dark);}
.commodity-category{background:var(--light);color:var(--dark);padding:4px 10px;border-radius:20px;font-size:0.8rem;}
.price-info{margin:15px 0;}
.best-price{font-size:1.8rem;font-weight:bold;color:var(--success);margin-bottom:5px;}
.best-store{color:#666;font-size:0.9rem;margin-bottom:10px;}
.price-list{border-top:1px solid var(--border);padding-top:10px;margin-top:10px;}
.price-item{display:flex;justify-content:space-between;align-items:center;padding:8px 0;border-bottom:1px solid #f0f0f0;}
.price-item:last-child{border-bottom:none;}
.store-name{font-weight:500;color:#555;}
.store-price{font-weight:600;color:var(--dark);}
.chart-container{position:relative;height:400px;margin:30px 0;padding:20px;background:white;border-radius:15px;box-shadow:0 3px 10px rgba(0,0,0,0.1);}
.alert-section{background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);border-radius:15px;padding:25px;margin-top:20px;color:white;}
.alert-form{display:flex;gap:15px;align-items:end;flex-wrap:wrap;}
.alert-input-group{flex:1;min-width:200px;}
.alert-input-group label{display:block;margin-bottom:5px;font-weight:500;}
.alert-input-group input,.alert-input-group select{width:100%;}
.alerts-list{margin-top:20px;max-height:200px;overflow-y:auto;}
.alert-item{background:rgba(255,255,255,0.1);padding:10px;border-radius:8px;margin-bottom:10px;display:flex;justify-content:space-between;align-items:center;}
.delete-alert{background:var(--danger);padding:5px 10px;font-size:0.8rem;}
.loading{text-align:center;padding:50px;font-size:1.2rem;color:#666;}
.spinner{border:4px solid var(--border);border-top:4px solid var(--primary);border-radius:50%;width:50px;height:50px;animation:spin 1s linear infinite;margin:20px auto;}
@keyframes spin{0%{transform:rotate(0deg);}100%{transform:rotate(360deg);}}
.trend-badge{display:inline-flex;align-items:center;gap:5px;padding:4px 10px;border-radius:20px;font-size:0.85rem;font-weight:600;}
.trend-up{background:#ffebee;color:var(--danger);}
.trend-down{background:#e8f5e9;color:var(--success);}
.trend-stable{background:#fff3e0;color:var(--warning);}
@media(max-width:768px){h1{font-size:1.8rem;}.commodity-grid{grid-template-columns:1fr;}.search-controls{flex-direction:column;}.search-input,.filter-select{width:100%;}}
</style>
</head>
<body>
<div class="container">
<header>
<h1><div class="flag"></div>Kenya Commodity Price Tracker</h1>
<p class="subtitle">Real-time price monitoring across major Kenyan online stores</p>
<div class="stats-grid">
<div class="stat-card"><div class="stat-value" id="totalItems">50</div><div class="stat-label">Items Tracked</div></div>
<div class="stat-card"><div class="stat-value" id="totalStores">5</div><div class="stat-label">Stores Monitored</div></div>
<div class="stat-card"><div class="stat-value" id="lastUpdate">--</div><div class="stat-label">Last Update</div></div>
<div class="stat-card"><div class="stat-value" id="avgSavings">--</div><div class="stat-label">Avg. Savings</div></div>
</div>
</header>
<div class="search-section">
<div class="search-controls">
<input type="text" class="search-input" id="searchInput" placeholder="Search for commodities...">
<select class="filter-select" id="categoryFilter">
<option value="">All Categories</option>
<option value="Staples">Staples</option>
<option value="Dairy">Dairy</option>
<option value="Beverages">Beverages</option>
<option value="Spreads">Spreads</option>
<option value="Energy">Energy</option>
<option value="Produce">Fresh Produce</option>
<option value="Household">Household</option>
<option value="Personal Care">Personal Care</option>
<option value="Baby Care">Baby Care</option>
</select>
<select class="filter-select" id="storeFilter">
<option value="">All Stores</option>
<option value="Jumia">Jumia</option>
<option value="Naivas">Naivas</option>
<option value="Carrefour">Carrefour</option>
<option value="Quickmart">Quickmart</option>
<option value="Chandarana">Chandarana</option>
</select>
<button onclick="refreshData()">🔄 Refresh Prices</button>
</div>
</div>
<div class="tabs">
<div class="tab active" onclick="switchTab('prices')">Current Prices</div>
<div class="tab" onclick="switchTab('trends')">Price Trends</div>
<div class="tab" onclick="switchTab('alerts')">Price Alerts</div>
<div class="tab" onclick="switchTab('comparison')">Store Comparison</div>
</div>
<div class="content-area" id="contentArea">
<div class="loading"><div class="spinner"></div>Loading price data...</div>
</div>
</div>

<script>
// ======= Sample commodities
const COMMODITIES = {
maize_flour:{name:"Maize Flour",canonical_unit:"2kg",category:"Staples"},
rice:{name:"Rice (Long Grain)",canonical_unit:"2kg",category:"Staples"},
sugar:{name:"Sugar",canonical_unit:"2kg",category:"Staples"}
};
let priceData = [];
let currentTab='prices';
let chartInstance=null;
let alerts=[];

// ======= Generate sample data
function generateSampleData(){
    const stores=['Jumia','Naivas','Carrefour','Quickmart','Chandarana'];
    const basePrices={maize_flour:150,rice:280,sugar:160};
    const data=[];
    Object.keys(COMMODITIES).forEach(id=>{
        const commodity=COMMODITIES[id];
        const base=basePrices[id]||100;
        stores.forEach(store=>{
            const variation=(Math.random()-0.5)*0.3;
            data.push({
                commodity_id:id,
                commodity_name:commodity.name,
                category:commodity.category,
                canonical_unit:commodity.canonical_unit,
                store:store,
                price:Math.round(base*(1+variation)*100)/100,
                unit_price:Math.round(base*(1+variation)*100)/100,
                timestamp:new Date().toISOString(),
                in_stock:true
            });
        });
    });
    return data;
}

// ======= Display Prices safely
function displayPrices(){
    const contentArea=document.getElementById('contentArea');
    const filteredData=getFilteredData();
    const commodityGroups={};
    filteredData.forEach(item=>{
        if(!item.commodity_id||!item.commodity_name||!item.store) return; // skip invalid
        if(!commodityGroups[item.commodity_id]){
            commodityGroups[item.commodity_id]={name:item.commodity_name,category:item.category,unit:item.canonical_unit,prices:[]};
        }
        commodityGroups[item.commodity_id].prices.push({
            store:item.store||'Unknown Store',
            price:item.price||0,
            in_stock:item.in_stock!==undefined?item.in_stock:false
        });
    });
    let html='<div class="commodity-grid">';
    Object.entries(commodityGroups).forEach(([id,commodity])=>{
        const sortedPrices=commodity.prices.filter(p=>p.in_stock).sort((a,b)=>a.price-b.price);
        if(sortedPrices.length===0) return;
        const bestPrice=sortedPrices[0];
        const trend=Math.random()>.5?'up':Math.random()>.5?'down':'stable';
        const trendIcon=trend==='up'?'📈':trend==='down'?'📉':'➡️';
        const trendClass=`trend-${trend}`;
        html+=`<div class="commodity-card">
        <div class="commodity-header">
        <div><div class="commodity-name">${commodity.name}</div><div class="commodity-category">${commodity.category}</div></div>
        <div class="trend-badge ${trendClass}">${trendIcon} ${Math.round(Math.random()*10)}%</div>
        </div>
        <div class="price-info"><div class="best-price">KSh ${bestPrice.price.toFixed(2)}</div>
        <div class="best-store">Best at ${bestPrice.store} / ${commodity.unit}</div></div>
        <div class="price-list">`;
        sortedPrices.slice(0,4).forEach(price=>{
            html+=`<div class="price-item"><span class="store-name">${price.store}</span><span class="store-price">KSh ${price.price.toFixed(2)}</span></div>`;
        });
        html+='</div></div>';
    });
    html+='</div>';
    contentArea.innerHTML=html;
}

// ======= Filters
function getFilteredData(){
    const searchTerm=document.getElementById('searchInput')?.value?.toLowerCase()||'';
    const categoryFilter=document.getElementById('categoryFilter')?.value||'';
    const storeFilter=document.getElementById('storeFilter')?.value||'';
    return priceData.filter(item=>{
        return (!searchTerm||item.commodity_name.toLowerCase().includes(searchTerm))
            &&(!categoryFilter||item.category===categoryFilter)
            &&(!storeFilter||item.store===storeFilter);
    });
}

// ======= Tab switch
function switchTab(tab){
    currentTab=tab;
    document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active'));
    event.target.classList.add('active');
    if(tab==='prices') displayPrices();
}

// ======= Refresh
function refreshData(){
    const contentArea=document.getElementById('contentArea');
    contentArea.innerHTML=`<div class="loading"><div class="spinner"></div>Fetching latest prices...</div>`;
    setTimeout(()=>{
        priceData=generateSampleData();
        displayPrices();
    },1000);
}

// ======= Init
window.addEventListener('DOMContentLoaded',()=>{
    priceData=generateSampleData();
    displayPrices();
    document.getElementById('searchInput').addEventListener('input',displayPrices);
    document.getElementById('categoryFilter').addEventListener('change',displayPrices);
    document.getElementById('storeFilter').addEventListener('change',displayPrices);
});
</script>
</body>
</html>
